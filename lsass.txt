I2luY2x1ZGUgPHdpbmRvd3MuaD4KI2luY2x1ZGUgPHRsaGVscDMyLmg+CiNpbmNsdWRlIDxzdGRp
by5oPgojaW5jbHVkZSA8c2RkbC5oPgoKdHlwZWRlZiBCT09MKFdJTkFQSSogTWluaUR1bXBXX3Qp
KERXT1JELCBMUENXU1RSLCBMT05HKTsKCkJPT0wgSXNSdW5uaW5nQXNTeXN0ZW0oKSB7CiAgICBI
QU5ETEUgdG9rZW4gPSBOVUxMOwogICAgaWYgKCFPcGVuUHJvY2Vzc1Rva2VuKEdldEN1cnJlbnRQ
cm9jZXNzKCksIFRPS0VOX1FVRVJZLCAmdG9rZW4pKSB7CiAgICAgICAgcmV0dXJuIEZBTFNFOwog
ICAgfQoKICAgIERXT1JEIHNpemUgPSAwOwogICAgR2V0VG9rZW5JbmZvcm1hdGlvbih0b2tlbiwg
VG9rZW5Vc2VyLCBOVUxMLCAwLCAmc2l6ZSk7CiAgICBQVE9LRU5fVVNFUiB0b2tlblVzZXIgPSAo
UFRPS0VOX1VTRVIpR2xvYmFsQWxsb2MoR1BUUiwgc2l6ZSk7CgogICAgaWYgKCFHZXRUb2tlbklu
Zm9ybWF0aW9uKHRva2VuLCBUb2tlblVzZXIsIHRva2VuVXNlciwgc2l6ZSwgJnNpemUpKSB7CiAg
ICAgICAgQ2xvc2VIYW5kbGUodG9rZW4pOwogICAgICAgIEdsb2JhbEZyZWUodG9rZW5Vc2VyKTsK
ICAgICAgICByZXR1cm4gRkFMU0U7CiAgICB9CgogICAgTFBXU1RSIHNpZFN0cmluZyA9IE5VTEw7
CiAgICBDb252ZXJ0U2lkVG9TdHJpbmdTaWRXKHRva2VuVXNlci0+VXNlci5TaWQsICZzaWRTdHJp
bmcpOwogICAgQk9PTCBpc1N5c3RlbSA9ICh3Y3NjbXAoc2lkU3RyaW5nLCBMIlMtMS01LTE4Iikg
PT0gMCk7IC8vIFNJRCBmb3IgU1lTVEVNCgogICAgTG9jYWxGcmVlKHNpZFN0cmluZyk7CiAgICBD
bG9zZUhhbmRsZSh0b2tlbik7CiAgICBHbG9iYWxGcmVlKHRva2VuVXNlcik7CiAgICByZXR1cm4g
aXNTeXN0ZW07Cn0KCmludCB3bWFpbigpIHsKICAgIGlmICghSXNSdW5uaW5nQXNTeXN0ZW0oKSkg
ewogICAgICAgIHdwcmludGYoTCJbIV0gTm90IHJ1bm5pbmcgYXMgU1lTVEVNLiBFeGl0aW5nLlxu
Iik7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgd3ByaW50ZihMIlsrXSBSdW5uaW5nIGFz
IFNZU1RFTS4gUHJvY2VlZGluZyB0byBkdW1wIExTQVNTLi4uXG4iKTsKCiAgICAvLyBHZXQgUElE
IG9mIExTQVNTCiAgICBEV09SRCBwaWQgPSAwOwogICAgSEFORExFIHNuYXBzaG90ID0gQ3JlYXRl
VG9vbGhlbHAzMlNuYXBzaG90KFRIMzJDU19TTkFQUFJPQ0VTUywgMCk7CiAgICBpZiAoc25hcHNo
b3QgPT0gSU5WQUxJRF9IQU5ETEVfVkFMVUUpIHsKICAgICAgICB3cHJpbnRmKEwiWyFdIEZhaWxl
ZCB0byBjcmVhdGUgcHJvY2VzcyBzbmFwc2hvdC5cbiIpOwogICAgICAgIHJldHVybiAxOwogICAg
fQoKICAgIFBST0NFU1NFTlRSWTMyVyBlbnRyeSA9IHsgMCB9OwogICAgZW50cnkuZHdTaXplID0g
c2l6ZW9mKFBST0NFU1NFTlRSWTMyVyk7CiAgICBpZiAoUHJvY2VzczMyRmlyc3RXKHNuYXBzaG90
LCAmZW50cnkpKSB7CiAgICAgICAgZG8gewogICAgICAgICAgICBpZiAoX3djc2ljbXAoZW50cnku
c3pFeGVGaWxlLCBMImxzYXNzLmV4ZSIpID09IDApIHsKICAgICAgICAgICAgICAgIHBpZCA9IGVu
dHJ5LnRoMzJQcm9jZXNzSUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog
ICAgICAgIH0gd2hpbGUgKFByb2Nlc3MzMk5leHRXKHNuYXBzaG90LCAmZW50cnkpKTsKICAgIH0K
ICAgIENsb3NlSGFuZGxlKHNuYXBzaG90KTsKCiAgICBpZiAocGlkID09IDApIHsKICAgICAgICB3
cHJpbnRmKEwiWyFdIENvdWxkIG5vdCBmaW5kIExTQVNTIFBJRC5cbiIpOwogICAgICAgIHJldHVy
biAxOwogICAgfQoKICAgIC8vIExvYWQgY29tc3Zjcy5kbGwgYW5kIGNhbGwgTWluaUR1bXBXCiAg
ICBITU9EVUxFIGhDb21zdmNzID0gTG9hZExpYnJhcnlXKEwiY29tc3Zjcy5kbGwiKTsKICAgIGlm
ICghaENvbXN2Y3MpIHsKICAgICAgICB3cHJpbnRmKEwiWyFdIEZhaWxlZCB0byBsb2FkIGNvbXN2
Y3MuZGxsXG4iKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBNaW5pRHVtcFdfdCBNaW5p
RHVtcFcgPSAoTWluaUR1bXBXX3QpR2V0UHJvY0FkZHJlc3MoaENvbXN2Y3MsICJNaW5pRHVtcFci
KTsKICAgIGlmICghTWluaUR1bXBXKSB7CiAgICAgICAgd3ByaW50ZihMIlshXSBGYWlsZWQgdG8g
Z2V0IE1pbmlEdW1wVyBmdW5jdGlvbiBhZGRyZXNzLlxuIik7CiAgICAgICAgcmV0dXJuIDE7CiAg
ICB9CgogICAgV0NIQVIgZHVtcFBhdGhbTUFYX1BBVEhdID0gTCJDOlxcV2luZG93c1xcVGVtcFxc
bHNhc3MuZG1wIjsKICAgIHdwcmludGYoTCJbK10gRHVtcGluZyBMU0FTUyBtZW1vcnkgdG8gJWxz
XG4iLCBkdW1wUGF0aCk7CgogICAgaWYgKCFNaW5pRHVtcFcocGlkLCBkdW1wUGF0aCwgMSkpIHsK
ICAgICAgICB3cHJpbnRmKEwiWyFdIER1bXAgZmFpbGVkLlxuIik7CiAgICAgICAgcmV0dXJuIDE7
CiAgICB9CgogICAgd3ByaW50ZihMIlsrXSBMU0FTUyBtZW1vcnkgZHVtcGVkIHN1Y2Nlc3NmdWxs
eS5cbiIpOwogICAgcmV0dXJuIDA7Cn0K
